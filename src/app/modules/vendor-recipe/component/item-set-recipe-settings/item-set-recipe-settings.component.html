<app-card>
  <div class="row">
    <div class="col-3" (click)="collapsed = !collapsed">
      <div class="title">
        <mat-icon>{{ collapsed ? 'keyboard_arrow_down' : 'keyboard_arrow_up' }}</mat-icon>
        {{ (identifier + 1) }}.
        <div class="recipe-count-large-icon" [style.background-image]="getIconBackgroundImage(selectedLargeIcon)" *ngIf="selectedLargeIcon || selectedSmallIcon">
          <div class="recipe-count-small-icon" [style.background-image]="getIconBackgroundImage(selectedSmallIcon)"></div>
        </div>
        {{ 'vendor-recipe.item-set-settings.title.' + (VendorRecipeType[settings.type] | lowercase) | translate }}
      </div>
    </div>
    <div class="col-2">
      <mat-slide-toggle [checked]="settings.enabled" (change)="settings.enabled = $event.checked">
        {{ 'settings.enabled' | translate }}
      </mat-slide-toggle>
    </div>
    <ng-content select="[slot=drag-handle]"></ng-content>
    <div class="col-1 text-right">
      <button mat-raised-button (click)="onResetSettingsClick()">
        {{ 'vendor-recipe.item-set-panel.reset' | translate }}
      </button>
    </div>
    <div class="col-1 text-right">
      <button mat-icon-button (click)="remove.emit()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
  <div class="row" [class.hidden]="collapsed || !settings.enabled">
    <div class="col-3">
      <mat-form-field matTooltip="{{ 'vendor-recipe.item-set-settings.large-icon-tooltip' | translate }}">
        <mat-label>{{ 'vendor-recipe.item-set-settings.large-icon' | translate }}</mat-label>
        <mat-select [(value)]="settings.largeIconId">
          <mat-select-trigger>
            <ng-container *ngIf="selectedLargeIcon">
              <img [src]="'https://web.poecdn.com' + selectedLargeIcon.image" class="currency" style="top: -5px;" />
              <span class="currency-label">{{ selectedLargeIcon.nameType }}</span>
            </ng-container>
          </mat-select-trigger>
          <mat-option [value]="">
            <i>No Icon</i>
          </mat-option>
          <mat-option *ngFor="let currency of currencies$ | async" [value]="currency.id">
            <img [src]="'https://web.poecdn.com' + currency.image" class="currency" style="top: 10px;" />
            <span class="currency-label">{{ currency.nameType }}</span>
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-3">
      <mat-form-field matTooltip="{{ 'vendor-recipe.item-set-settings.small-icon-tooltip' | translate }}">
        <mat-label>{{ 'vendor-recipe.item-set-settings.small-icon' | translate }}</mat-label>
        <mat-select [(value)]="settings.smallIconId">
          <mat-select-trigger>
            <ng-container *ngIf="selectedSmallIcon">
              <img [src]="'https://web.poecdn.com' + selectedSmallIcon.image" class="currency" style="top: -5px;" />
              <span class="currency-label">{{ selectedSmallIcon.nameType }}</span>
            </ng-container>
          </mat-select-trigger>
          <mat-option [value]="">
            <i>No Icon</i>
          </mat-option>
          <mat-option *ngFor="let currency of currencies$ | async" [value]="currency.id">
            <img [src]="'https://web.poecdn.com' + currency.image" class="currency" style="top: 10px;" />
            <span class="currency-label">{{ currency.nameType }}</span>
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <div class="row" [class.hidden]="collapsed || !settings.enabled">
    <div class="col-2">
      <mat-form-field>
        <mat-label>{{ 'vendor-recipe.item-set-settings.item-threshold' | translate }}</mat-label>
        <mat-select [(value)]="settings.itemThreshold">
          <mat-option *ngFor="
              let value of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 30, 35, 40, 45, 50]
            " [value]="value">
            {{ value }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-2">
      <mat-form-field>
        <mat-label>{{ 'vendor-recipe.item-set-settings.full-set-threshold' | translate }}</mat-label>
        <mat-select [(value)]="settings.fullSetThreshold">
          <mat-option *ngFor="
              let value of [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, 30, 35, 40, 45, 50]
            " [value]="value">
            {{ value }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-3">
      <mat-slide-toggle [checked]="settings.showItemAmounts" (change)="settings.showItemAmounts = $event.checked">
        {{ 'vendor-recipe.item-set-settings.show-item-amounts' | translate }}
      </mat-slide-toggle>
    </div>
    <div class="col-2">
      <mat-form-field>
        <mat-label>{{ 'vendor-recipe.item-set-settings.highlight-mode' | translate }}</mat-label>
        <mat-select [(value)]="settings.highlightMode">
          <mat-option *ngFor="let highlightMode of highlightModes.keys" [value]="highlightMode" matTooltip="{{ 'vendor-recipe.item-set-settings.highlight-mode-tooltips.' + (highlightModes.values[highlightMode] | lowercase) | translate }}" matTooltipClass="mat-tooltip-lighter" matTooltipPosition="left">
            {{ 'vendor-recipe.item-set-settings.highlight-modes.' + (highlightModes.values[highlightMode] | lowercase) | translate }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-2">
      <mat-form-field>
        <mat-label>{{ 'vendor-recipe.item-set-settings.highlight-order' | translate }}</mat-label>
        <mat-select [(value)]="settings.highlightOrder">
          <mat-option *ngFor="let highlightOrder of highlightOrders.keys" [value]="highlightOrder" matTooltip="{{ 'vendor-recipe.item-set-settings.highlight-order-tooltips.' + (highlightOrders.values[highlightOrder] | lowercase) | translate }}" matTooltipClass="mat-tooltip-lighter" matTooltipPosition="left">
            {{ 'vendor-recipe.item-set-settings.highlight-orders.' + (highlightOrders.values[highlightOrder] | lowercase) | translate }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <div class="row" [class.hidden]="collapsed || !settings.enabled">
    <div class="col-3" *ngIf="settings.type === VendorRecipeType.Chaos">
      <mat-slide-toggle [checked]="levelBasedSettings.fillGreedy" (change)="levelBasedSettings.fillGreedy = $event.checked" matTooltip="{{ 'vendor-recipe.item-set-settings.fill-greedy-tooltip' | translate }}">
        {{ 'vendor-recipe.item-set-settings.fill-greedy' | translate }}
      </mat-slide-toggle>
    </div>
    <div class="col-3">
      <mat-form-field>
        <mat-label>{{ 'vendor-recipe.item-set-settings.identified-item-usage' | translate }}</mat-label>
        <mat-select [(value)]="settings.identifiedItemUsage">
          <mat-option *ngFor="let itemUsageType of itemUsageTypes.keys" [value]="itemUsageType" matTooltip="{{ 'vendor-recipe.item-set-settings.identified-item-usage-tooltips.' + (itemUsageTypes.values[itemUsageType] | lowercase) | translate }}" matTooltipClass="mat-tooltip-lighter" matTooltipPosition="left">
            {{ 'vendor-recipe.item-set-settings.item-usage.' + (itemUsageTypes.values[itemUsageType] | lowercase) | translate }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-3">
      <mat-form-field>
        <mat-label>{{ 'vendor-recipe.item-set-settings.quality-item-usage' | translate }}</mat-label>
        <mat-select [(value)]="settings.qualityItemUsage">
          <mat-option *ngFor="let itemUsageType of itemUsageTypes.keys" [value]="itemUsageType" matTooltip="{{ 'vendor-recipe.item-set-settings.quality-item-usage-tooltips.' + (itemUsageTypes.values[itemUsageType] | lowercase) | translate }}" matTooltipClass="mat-tooltip-lighter" matTooltipPosition="left">
            {{ 'vendor-recipe.item-set-settings.item-usage.' + (itemUsageTypes.values[itemUsageType] | lowercase) | translate }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <div class="row" [class.hidden]="collapsed || !settings.enabled">
    <div class="col-3">
      <mat-form-field>
        <mat-label>{{ 'vendor-recipe.item-set-settings.stash-tab-search-mode' | translate }}</mat-label>
        <mat-select [(value)]="settings.stashTabSearchMode">
          <mat-option *ngFor="let stashTabSearchMode of stashTabSearchModes.keys" [value]="stashTabSearchMode" matTooltip="{{ 'vendor-recipe.item-set-settings.stash-tab-search-tooltips.' + (stashTabSearchModes.values[stashTabSearchMode] | lowercase) | translate }}" matTooltipClass="mat-tooltip-lighter" matTooltipPosition="left">
            {{ 'vendor-recipe.item-set-settings.stash-tab-search-modes.' + (stashTabSearchModes.values[stashTabSearchMode] | lowercase) | translate }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="col-6">
      <mat-form-field matTooltip="{{ 'vendor-recipe.item-set-settings.stash-tab-search-tooltips.' + (stashTabSearchModes.values[settings.stashTabSearchMode] | lowercase) | translate }}">
        <mat-label>{{ 'vendor-recipe.item-set-settings.stash-tab-search-value' | translate }}</mat-label>
        <input matInput [(ngModel)]="settings.stashTabSearchValue" />
      </mat-form-field>
    </div>
  </div>
  <mat-card class="card" [class.hidden]="collapsed || !settings.enabled">
    <mat-label>{{ 'vendor-recipe.item-set-settings.item-set-groups' | translate }}</mat-label>
    <div class="row">
      <div class="col-3">
        <mat-slide-toggle [checked]="settings.groupWeaponsTogether" (change)="settings.groupWeaponsTogether = $event.checked">
          {{ 'vendor-recipe.item-set-settings.group-weapons-together' | translate }}
        </mat-slide-toggle>
      </div>
    </div>
    <div class="row">
      <div class="col-4" *ngFor="let itemSetGroup of itemSetGroups.keys; let index = index">
        <ng-container *ngTemplateOutlet="
                      itemSetGroupTemplate;
                      context: {
                        index: index,
                        itemClassColor: getItemColorGroup(settings, itemSetGroup),
                        defaultItemClassColor: getItemColorGroup(defaultSettings, itemSetGroup)
                      }
                      ">
        </ng-container>
        <ng-template #itemSetGroupTemplate let-index="index" let-itemClassColor="itemClassColor" let-defaultItemClassColor="defaultItemClassColor">
          <mat-card class="card" [style]="canShowItemColorGroup(itemSetGroup) ? '' : 'display: none;'">
            <mat-label>
              {{ 'vendor-recipe.item-set-settings.item-set-group-names.' + getItemColorGroupName(itemClassColor.group) | translate }}
              <div class="item-set-icon {{ getItemColorGroupName(itemClassColor.group) }} item-set-icon-preview"
                   [style]="'background-color: ' + ColorUtils.toRGBA(itemClassColor.color) + ';'">
              </div>
            </mat-label>
            <div class="row">
              <mat-slide-toggle [checked]="itemClassColor.showOnOverlay" (change)="itemClassColor.showOnOverlay = $event.checked" matTooltip="{{ 'vendor-recipe.item-set-settings.show-on-overlay-tooltip' | translate }}">
                {{ 'vendor-recipe.item-set-settings.show-on-overlay' | translate }}
              </mat-slide-toggle>
            </div>
            <div class="row">
              <app-color-picker-settings [side]="index % 3 == 0 ? 'right' : 'left'"
                                         [label]="'vendor-recipe.item-set-settings.item-set-group-bg-color'"
                                         [color]="itemClassColor.color"
                                         [defaultColor]="defaultItemClassColor.color"
                                         [tooltip]="'vendor-recipe.item-set-settings.item-set-group-bg-color-tooltip' | translate"
                                         class="subcard">
              </app-color-picker-settings>
            </div>
          </mat-card>
        </ng-template>
      </div>
    </div>
  </mat-card>
  <mat-card class="card" [class.hidden]="collapsed || !settings.enabled">
    <mat-label>{{ 'settings.audio-options' | translate }}</mat-label>
    <div class="row">
      <app-audio-clip-settings class="col-md-4 subcard" [settings]="settings.recipeCompleteAudio" [title]="'vendor-recipe.item-set-settings.audio.recipe-complete' | translate"></app-audio-clip-settings>
      <app-audio-clip-settings class="col-md-4 subcard" [settings]="settings.itemThresholdAudio" [title]="'vendor-recipe.item-set-settings.audio.item-threshold' | translate"></app-audio-clip-settings>
      <app-audio-clip-settings class="col-md-4 subcard" [settings]="settings.fullSetThresholdAudio" [title]="'vendor-recipe.item-set-settings.audio.full-set-threshold' | translate"></app-audio-clip-settings>
    </div>
  </mat-card>
</app-card>
